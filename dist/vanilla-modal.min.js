/**
 * @name vanilla-modal
 * @version 0.3.3
 * @author Ben Ceglowski
 * @url http://phuse.ca
 * @date 2015-01-26
 * @license MIT
 */;"use strict";var _prototypeProperties=function(a,b,c){b&&Object.defineProperties(a,b),c&&Object.defineProperties(a.prototype,c)},VanillaModal=function(){function a(a){this.$$={modal:".modal",modalInner:".modal-inner",modalContent:".modal-content",open:'[rel="modal:open"]',close:'[rel="modal:close"]',page:"body","class":"modal-visible",loadClass:"vanilla-modal",href:!1,clickOutside:!0,escapeKey:!0,transitions:!0,onBeforeOpen:function(){},onBeforeClose:function(){},onOpen:function(){},onClose:function(){}},this.isOpen=!1,this.open=this._open.bind(this),this.close=this._close.bind(this),this.escapeKeyHandler=this._escapeKeyHandler.bind(this),this.outsideClickHandler=this._outsideClickHandler.bind(this),this.closeTransitionHandler=this._closeTransitionHandler.bind(this),this.userSettings=this._applyUserSettings(a),this.transitionEnd=this._transitionEndVendorSniff(),this.$=this._setupDomNodes(),this._addLoadedCssClass(),this._addEvents()}return _prototypeProperties(a,null,{_applyUserSettings:{value:function(){if("object"==typeof this.userSettings)for(var a in this.userSettings)userSettings.hasOwnProperty(a)&&(this.$$[a]=this.userSettings[a])},writable:!0,enumerable:!0,configurable:!0},_transitionEndVendorSniff:{value:function(){if(this.$$.transitions!==!1){var a=document.createElement("div"),b={transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var c in b)if(b.hasOwnProperty(c)&&void 0!==a.style[c])return b[c]}},writable:!0,enumerable:!0,configurable:!0},_getNode:{value:function(a,b){var c=b||document,d=c.querySelector(a);return d?d:console.error('Element "'+a+'" does not exist in context.')},writable:!0,enumerable:!0,configurable:!0},_getNodeList:{value:function(a,b){var c=b||document,d=c.querySelectorAll(a);return d.length?d:console.error('Element "'+a+'" does not exist in context.')},writable:!0,enumerable:!0,configurable:!0},_setupDomNodes:{value:function(){var a={};return a.modal=this._getNode(this.$$.modal),a.page=this._getNode(this.$$.page),a.modalInner=this._getNode(this.$$.modalInner,this.modal),a.modalContent=this._getNode(this.$$.modalContent,this.modal),a.open=this._getNodeList(this.$$.open),a.close=this._getNodeList(this.$$.close),a},writable:!0,enumerable:!0,configurable:!0},_addLoadedCssClass:{value:function(){this._addClass(this.$.page,this.$$.loadClass)},writable:!0,enumerable:!0,configurable:!0},_addClass:{value:function(a,b){if(!(!a instanceof HTMLElement)){var c=a.className.split(" ");-1===c.indexOf(b)&&c.push(b),a.className=c.join(" ")}},writable:!0,enumerable:!0,configurable:!0},_removeClass:{value:function(a,b){if(!(!a instanceof HTMLElement)){var c=a.className.split(" ");c.indexOf(b)>-1&&c.splice(c.indexOf(b),1),a.className=c.join(" ")}},writable:!0,enumerable:!0,configurable:!0},_setOpenId:{value:function(){var a=this.$$.href.id||"anonymous";this.$.page.setAttribute("data-current-modal",a)},writable:!0,enumerable:!0,configurable:!0},_removeOpenId:{value:function(){this.$.page.removeAttribute("data-current-modal")},writable:!0,enumerable:!0,configurable:!0},_getElementContext:{value:function(a){return a.currentTarget&&"string"==typeof a.currentTarget.hash?document.querySelector(a.currentTarget.hash):"string"==typeof a?document.querySelector(a):void 0},writable:!0,enumerable:!0,configurable:!0},_open:{value:function(a){return this.$$.href=this._getElementContext(a),this.$$.href instanceof HTMLElement==!1?console.error('Element "'+this.$$.href+'" does not exist in context.'):("function"==typeof this.$$.onBeforeOpen&&this.$$.onBeforeOpen.bind(this),this._captureNode(),this._addClass(this.$.page,this.$$["class"]),this._setOpenId(),this.isOpen=!0,"function"==typeof this.$$.onOpen&&this.$$.onOpen.bind(this),void(a&&"function"==typeof a.preventDefault&&a.preventDefault()))},writable:!0,enumerable:!0,configurable:!0},_close:{value:function(a){"function"==typeof this.$$.onBeforeClose&&this.$$.onBeforeClose.bind(this),this._removeClass(this.$.page,this.$$["class"]),this.$$.transitions&&this.transitionEnd?this._closeModalWithTransition():this._closeModal(),a&&"function"==typeof a.preventDefault&&a.preventDefault()},writable:!0,enumerable:!0,configurable:!0},_closeModal:{value:function(){this._removeOpenId(this.$.page),this._releaseNode(),this.isOpen=!1,"function"==typeof this.$$.onClose&&this.$$.onClose.bind(this)},writable:!0,enumerable:!0,configurable:!0},_closeTransitionHandler:{value:function(){this.$.modal.removeEventListener(this.transitionEnd,this.closeTransitionHandler),this._closeModal()},writable:!0,enumerable:!0,configurable:!0},_closeModalWithTransition:{value:function(){this.$.modal.addEventListener(this.transitionEnd,this.closeTransitionHandler)},writable:!0,enumerable:!0,configurable:!0},_captureNode:{value:function(){try{for(;this.$$.href.childNodes.length>0;)this.$.modalContent.appendChild(this.$$.href.childNodes[0])}catch(a){return console.error("The target modal has no child elements.")}},writable:!0,enumerable:!0,configurable:!0},_releaseNode:{value:function(){try{for(;this.$.modalContent.childNodes.length>0;)this.$$.href.appendChild(this.$.modalContent.childNodes[0])}catch(a){return console.error("The modal's original container no longer exists.")}},writable:!0,enumerable:!0,configurable:!0},_escapeKeyHandler:{value:function(a){27===a.keyCode&&this.isOpen===!0&&(a.preventDefault(),this.close())},writable:!0,enumerable:!0,configurable:!0},_outsideClickHandler:{value:function(a){for(var b=a.target;b!=document.body;){if(b===this.$.modalInner)return;b=b.parentNode}this.close()},writable:!0,enumerable:!0,configurable:!0},_addEvent:{value:function(a,b,c){a.length||(a=[a]);for(var d=0;d<a.length;d++)a[d].addEventListener(b,c)},writable:!0,enumerable:!0,configurable:!0},_removeEvent:{value:function(a,b,c){for(var d=0;d<a.length;d++)a[d].removeEventListener(b,c)},writable:!0,enumerable:!0,configurable:!0},_addEvents:{value:function(){this._addEvent(this.$.open,"click",this.open),this._addEvent(this.$.close,"click",this.close),this.$$.escapeKey===!0&&this._addEvent(document,"keydown",this.escapeKeyHandler),this.$$.clickOutside===!0&&this._addEvent(this.$.modal,"click",this.outsideClickHandler)},writable:!0,enumerable:!0,configurable:!0},destroy:{value:function(){this.close(),this._removeEvent(this.$.open,"click",this.open),this._removeEvent(this.$.close,"click",this.close),this.$$.escapeKey===!0&&this._removeEvent(document,"keydown",this.escapeKeyHandler),this.$$.clickOutside===!0&&this._removeEvent(this.$.modal,"click",this.outsideClickHandler)},writable:!0,enumerable:!0,configurable:!0}}),a}();!function(){"function"==typeof define&&define.amd?define("VanillaModal",function(){return VanillaModal}):"undefined"!=typeof module&&module.exports?module.exports=VanillaModal:window.VanillaModal=VanillaModal}();